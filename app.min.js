// Specify actions that will take place before the tool's configuration is loaded into the manager.
Alteryx.Gui.BeforeLoad = function(manager, AlteryxDataItems){
  console.log("Before Load ---");
  //var isGLM = new AlteryxDataItems["SimpleBool"]({id: 'isGLM', dataName: 'isGLM'});
  //manager.AddDataItem(isGLM)
  //isGLM.setValue(true)
}

function displaySeed(manager){
  var displaySeed = manager.GetDataItem('displaySeed')
  var seedDiv = document.getElementById('input-seed');
  seedDiv.style.display = displaySeed.value ? 'block' : 'none'
  displaySeed.BindUserDataChanged(function(v){
    seedDiv.style.display = v ? 'block' : 'none'
  })
}

function controlDisplaySeed(manager){
  var displaySeed = manager.GetDataItem('displaySeed')
  var metaInfoS = manager.metaInfo.Get(2)
  if (metaInfoS._GetFields().length > 0){
    var fields = metaInfoS
      ._GetFields()
      .map(function(d){return d.strName})
    var fields = [].concat(fields)
    if (fields.indexOf('seed') >= 0){
      displaySeed.setValue(false)
    } else {
      displaySeed.setValue(true)
    }
  } else {
    displaySeed.setValue(true)
  }
}

function displayTarget(targetId, di, condition){
  if (typeof condition == "undefined"){
    var condition = function(v){return v}
  };
  var dataItem = Alteryx.Gui.manager.GetDataItem(di)
  var targetDiv = document.getElementById(targetId)
  console.log(targetDiv)
  function display(v){
    targetDiv.style.display = condition(v) ? 'none' : 'block'
  }
  dataItem.BindUserDataChanged(display)
  display(dataItem.value)
}

function controlIsGlm(manager){
  var metaInfoV = manager.metaInfo.Get(1)
  var isGLM = manager.GetDataItem('isGLM')
  isGLM.setValue(!(metaInfoV._GetFields().length === 0))
}


// Specify actions that will take place after the tool configuration is loaded into the manager
Alteryx.Gui.AfterLoad = function(manager){
  console.log("After Load ---");
  console.log(manager.GetDataItem("isGLM").value)
  var resname = manager.GetDataItem("results.name")
  if (resname.value === "") resname.setValue("Score")
  controlDisplaySeed(manager)
  displaySeed(manager)
  
  // display the div `target-variable` when data item `hasGLM` if `false`
  controlIsGlm(manager)
  //displayTarget("target-variable", "isGLM")
};

// Annotation on canvas
Alteryx.Gui.Annotation = function(manager){

};